<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶å¯¶éŠæˆ²æ™‚é–“</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #ffebee;
            font-family: Arial, sans-serif;
            overflow: hidden;
            transition: background-color 1s ease;
        }
        #game-container {
            text-align: center;
            position: relative;
            z-index: 1;
        }
        #background-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            transition: background-color 1s ease;
            overflow: hidden;
            background-color: #ffebee;
        }
        .scene-ocean {
            background: linear-gradient(180deg, #87CEEB 0%, #1E90FF 100%);
        }
        .scene-savanna {
            background: linear-gradient(180deg, #87CEEB 0%, #90EE90 100%);
        }
        .scene-farm {
            background: linear-gradient(180deg, #87CEEB 0%, #8FBC8F 100%);
        }
        .cloud {
            position: fixed;
            background: white;
            border-radius: 50px;
            animation: cloudFloat linear infinite;
            opacity: 0.8;
        }
        .rainbow {
            position: fixed;
            width: 200px;
            height: 100px;
            border-radius: 100px 100px 0 0;
            background: linear-gradient(
                180deg,
                #ff0000,
                #ff9900,
                #ffff00,
                #33ff33,
                #3333ff,
                #9900cc
            );
            opacity: 0.3;
            animation: rainbowFloat 15s linear infinite;
        }
        .star {
            position: fixed;
            color: yellow;
            font-size: 20px;
            animation: twinkle 1.5s ease-in-out infinite;
        }
        .butterfly {
            position: fixed;
            font-size: 24px;
            animation: butterflyFloat 10s linear infinite;
        }
        .flower {
            position: fixed;
            font-size: 30px;
            bottom: 20px;
            animation: flowerSway 3s ease-in-out infinite;
        }
        .bubble {
            position: fixed;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: bubbleFloat 8s linear infinite;
            pointer-events: none;
        }
        .leaf {
            position: fixed;
            font-size: 30px;
            animation: leafFloat 6s linear infinite;
            pointer-events: none;
        }
        .bird {
            position: fixed;
            font-size: 30px;
            animation: birdFly 12s linear infinite;
            pointer-events: none;
        }
        .fish {
            position: fixed;
            font-size: 30px;
            animation: fishSwim 10s linear infinite;
            pointer-events: none;
        }
        .flying-egg {
            position: fixed;
            width: 60px;
            height: 60px;
            pointer-events: none;
            z-index: 2;
            opacity: 0.8;
            transition: opacity 0.5s ease;
        }
        @keyframes eggFloat {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(25vw, 20vh) rotate(15deg);
            }
            50% {
                transform: translate(50vw, 40vh) rotate(-15deg);
            }
            75% {
                transform: translate(75vw, 20vh) rotate(15deg);
            }
            100% {
                transform: translate(100vw, 0) rotate(0deg);
            }
        }
        @keyframes cloudFloat {
            from { left: -100px; }
            to { left: 100vw; }
        }
        @keyframes rainbowFloat {
            0% { transform: translateX(-250px) rotate(-10deg); opacity: 0.3; }
            50% { opacity: 0.5; }
            100% { transform: translateX(100vw) rotate(-10deg); opacity: 0.3; }
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        @keyframes butterflyFloat {
            0% { transform: translate(-100px, 50vh) rotate(0deg); }
            25% { transform: translate(25vw, 30vh) rotate(20deg); }
            50% { transform: translate(50vw, 50vh) rotate(0deg); }
            75% { transform: translate(75vw, 30vh) rotate(-20deg); }
            100% { transform: translate(100vw, 50vh) rotate(0deg); }
        }
        @keyframes flowerSway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        @keyframes bubbleFloat {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            20% {
                opacity: 0.5;
            }
            80% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(-100px) scale(1.5);
                opacity: 0;
            }
        }
        @keyframes leafFloat {
            0% {
                transform: translateX(-100px) rotate(0deg);
                opacity: 0;
            }
            20% {
                opacity: 0.8;
            }
            80% {
                opacity: 0.8;
            }
            100% {
                transform: translateX(100vw) rotate(360deg);
                opacity: 0;
            }
        }
        @keyframes birdFly {
            0% {
                transform: translate(-100px, 20vh) scaleX(1);
            }
            25% {
                transform: translate(25vw, 30vh) scaleX(1);
            }
            50% {
                transform: translate(50vw, 20vh) scaleX(-1);
            }
            75% {
                transform: translate(75vw, 30vh) scaleX(-1);
            }
            100% {
                transform: translate(100vw, 20vh) scaleX(1);
            }
        }
        @keyframes fishSwim {
            0% {
                transform: translateX(-100px) scaleX(1);
            }
            50% {
                transform: translateX(50vw) scaleX(-1);
            }
            100% {
                transform: translateX(100vw) scaleX(1);
            }
        }
        #main-image {
            width: 300px;
            height: 300px;
            border-radius: 20px;
            transition: all 0.5s ease;
            cursor: pointer;
            object-fit: cover;
            position: relative;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        .image-container {
            position: relative;
            display: inline-block;
            margin: 20px;
            background: white;
            padding: 10px;
            border-radius: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .animal-name {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 24px;
            color: #ff6b6b;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 2;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .accessory {
            position: absolute;
            width: 100px;
            height: 100px;
            pointer-events: none;
            z-index: 2;
        }
        .hat {
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
        }
        .glasses {
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
        }
        .scarf {
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
        }
        #message {
            font-size: 24px;
            color: #ff6b6b;
            margin-top: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            background: white;
            padding: 10px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #counter {
            font-size: 48px;
            color: #4CAF50;
            margin-top: 10px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            background: white;
            padding: 10px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            cursor: pointer;
            transition: transform 0.2s;
        }
        #counter:hover {
            transform: scale(1.1);
        }
        #music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff9999;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 24px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        #music-control:hover {
            background: #ff7777;
            transform: scale(1.1);
        }
        .effect {
            position: fixed;
            pointer-events: none;
            animation: float 2s ease-out forwards;
            font-size: 40px;
            z-index: 1000;
        }
        @keyframes float {
            0% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(var(--moveX), var(--moveY)) scale(1.5) rotate(var(--rotation));
                opacity: 0;
            }
        }
        .firework {
            position: fixed;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            animation: firework 1s ease-out forwards;
            z-index: 1000;
        }
        @keyframes firework {
            0% {
                transform: translate(0, 0);
                opacity: 1;
            }
            100% {
                transform: translate(var(--x), var(--y));
                opacity: 0;
            }
        }
        .game-title {
            font-size: 64px;
            margin-bottom: 20px;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #4CAF50 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }
        /* ç§»é™¤èƒŒæ™¯å‹•ç‰©ç›¸é—œæ¨£å¼ */
    </style>
</head>
<body>
    <div id="background-scene"></div>
    <div id="game-container">
        <h1 class="game-title">ç¶ æ¾„äº‚æŒ‰</h1>
        <div class="image-container">
            <img id="main-image" src="ç‹—.png" alt="å¯æ„›å‹•ç‰©">
        </div>
        <div id="message">æŒ‰ä¸‹ä»»æ„éµä¾†ç©ï¼</div>
        <div id="counter">
            <div>æ•¸åˆ°å</div>
            <div style="font-size: 72px;">0</div>
        </div>
    </div>
    <button id="music-control">ğŸµ</button>
    <script>
        const images = [
            'ç‹—.png',      // ç‹—
            'ç¶¿ç¾Š.png',    // ç¶¿ç¾Š
            'é´¨å­.png',    // é´¨å­
            'è±¬.png',      // è±¬
            'å…”å­.png',    // å…”å­
            'è€è™.png',    // è€è™
            'é›.png',      // é›
            'è€é¼ .png',    // è€é¼ 
            'è²“å’ª.png',    // è²“
            'é‡‘é­š.png',    // é‡‘é­š
            'çƒé¾œ.png',    // çƒé¾œ
            'ä¹³ç‰›.png',    // ä¹³ç‰›
            'é¦¬.png',      // é¦¬
            'çŒ´å­.png'     // çŒ´å­
        ];

        // å‹•ç‰©åç¨±å°æ‡‰
        const animalNames = [
            'ç‹—ç‹—', 'ç¶¿ç¾Š', 'é´¨å­', 'å°è±¬',
            'å…”å­', 'è€è™', 'å°é›', 'è€é¼ ',
            'è²“å’ª', 'é‡‘é­š', 'çƒé¾œ', 'ä¹³ç‰›',
            'é¦¬å…’', 'çŒ´å­'
        ];

        // éŸ³æ•ˆè¨­å®š - å¯æ„›çš„éŸ³æ•ˆ
        const sounds = [
            'https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3',    // å¯æ„›çš„æœ¨ç´éŸ³æ•ˆ
            'https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3',    // æ­¡æ¨‚çš„éˆ´éºè²
            'https://assets.mixkit.co/active_storage/sfx/888/888-preview.mp3',      // è¼•å¿«çš„éŸ³æ•ˆ
            'https://assets.mixkit.co/active_storage/sfx/2152/2152-preview.mp3',    // æ‰“æ“ŠéŸ³æ•ˆ1
            'https://assets.mixkit.co/active_storage/sfx/2153/2153-preview.mp3'     // æ‰“æ“ŠéŸ³æ•ˆ2
        ];

        // èƒŒæ™¯éŸ³æ¨‚åˆ—è¡¨
        const backgroundMusics = [
            {
                url: '1233.mp3',
                name: 'æ­¡æ¨‚éŸ³æ¨‚'
            },
            {
                url: '1233.mp3',
                name: 'å¿«æ¨‚é‹¼ç´'
            },
            {
                url: '1233.mp3',
                name: 'è¼•å¿«æ—‹å¾‹'
            }
        ];

        let currentMusicIndex = 0;
        let isMusicPlaying = false;
        const backgroundMusic = new Audio();
        backgroundMusic.volume = 0.3;
        backgroundMusic.loop = true;

        const emojis = ['ğŸŒŸ', 'ğŸˆ', 'ğŸŒˆ', 'ğŸ’–', 'âœ¨', 'ğŸ¨', 'ğŸµ', 'ğŸ¦„'];
        const mainImage = document.getElementById('main-image');
        const gameContainer = document.getElementById('game-container');
        const musicControl = document.getElementById('music-control');
        let currentImageIndex = 0;
        let currentSoundIndex = 0;

        const accessories = {
            hats: ['ğŸ‘’', 'ğŸ©', 'ğŸ§¢', 'â›‘ï¸', 'ğŸ‘‘'],
            glasses: ['ğŸ‘“', 'ğŸ•¶ï¸', 'ğŸ¥½'],
            scarves: ['ğŸ§£']
        };

        const backgroundTypes = {
            fish: 'ocean',
            elephant: 'savanna',
            cow: 'farm',
            lion: 'savanna',
            dog: 'farm',
            cat: 'farm',
            sheep: 'farm'
        };

        let voiceTimer = null;
        let speechUtterance = null;
        let counter = 0;
        const rewardColors = [
            'linear-gradient(135deg, #FFB6C1 0%, #FF69B4 100%)',  // ç²‰ç´…è‰²æ¼¸å±¤
            'linear-gradient(135deg, #98FB98 0%, #32CD32 100%)',  // ç¶ è‰²æ¼¸å±¤
            'linear-gradient(135deg, #87CEEB 0%, #0000FF 100%)',  // è—è‰²æ¼¸å±¤
            'linear-gradient(135deg, #FFB6C1 0%, #FF69B4 100%)',  // ç²‰ç´…è‰²æ¼¸å±¤
            'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',  // é‡‘è‰²æ¼¸å±¤
            'linear-gradient(135deg, #90EE90 0%, #32CD32 100%)'   // ç¶ è‰²æ¼¸å±¤
        ];
        let currentColorIndex = 0;

        // ç´”è‰²ç‰ˆæœ¬ç”¨æ–¼é¡¯ç¤ºé¡è‰²åç¨±
        const solidColors = [
            '#FF69B4',  // ç²‰ç´…è‰²
            '#32CD32',  // ç¶ è‰²
            '#0000FF',  // è—è‰²
            '#FF69B4',  // ç²‰ç´…è‰²
            '#FFD700',  // é‡‘è‰²
            '#32CD32'   // ç¶ è‰²
        ];

        // åˆå§‹åŒ–èªéŸ³åˆæˆ
        const synth = window.speechSynthesis;
        
        function updateAnimalName(index) {
            // ç§»é™¤èˆŠçš„åç¨±æ¨™ç±¤
            const oldName = document.querySelector('.animal-name');
            if (oldName) {
                oldName.remove();
            }

            // å‰µå»ºæ–°çš„åç¨±æ¨™ç±¤
            const nameLabel = document.createElement('div');
            nameLabel.className = 'animal-name';
            nameLabel.textContent = animalNames[index];
            
            document.querySelector('.image-container').appendChild(nameLabel);
        }

        function speakAnimalName(index) {
            // å–æ¶ˆä¹‹å‰çš„èªéŸ³
            if (speechUtterance) {
                synth.cancel();
            }

            const name = animalNames[index];
            speechUtterance = new SpeechSynthesisUtterance(name);
            
            // è¨­ç½®èªéŸ³åƒæ•¸
            speechUtterance.lang = 'zh-TW';
            speechUtterance.rate = 0.9;
            speechUtterance.pitch = 1.2;
            speechUtterance.volume = 7.0;  // å¢åŠ éŸ³é‡åˆ° 7.0
            
            // å°‹æ‰¾æ›´é©åˆçš„èªéŸ³
            let voices = synth.getVoices();
            let childVoice = voices.find(voice => 
                voice.lang.includes('zh') && 
                (voice.name.includes('Child') || voice.name.includes('Kid')));
            
            if (!childVoice) {
                childVoice = voices.find(voice => 
                    voice.lang.includes('zh') && 
                    (voice.name.includes('Female') || voice.name.includes('Girl')));
            }
            
            if (!childVoice) {
                childVoice = voices.find(voice => voice.lang.includes('zh'));
            }
            
            if (childVoice) {
                speechUtterance.voice = childVoice;
            }

            // åªæ’­æ”¾å‹•ç‰©åç¨±ï¼Œç§»é™¤è‡ªå‹•æ’­æ”¾æ•¸å­—
            synth.speak(speechUtterance);
        }

        function startVoiceTimer() {
            if (voiceTimer) {
                clearTimeout(voiceTimer);
            }
            
            voiceTimer = setTimeout(() => {
                speakAnimalName(currentImageIndex);
            }, 1500);
        }

        // éŸ³æ¨‚æ§åˆ¶ç›¸é—œåŠŸèƒ½
        musicControl.addEventListener('click', () => {
            if (isMusicPlaying) {
                backgroundMusic.pause();
                musicControl.textContent = 'ğŸµ';
                isMusicPlaying = false;
            } else {
                playBackgroundMusic();
            }
        });

        // æ’­æ”¾èƒŒæ™¯éŸ³æ¨‚çš„å‡½æ•¸
        function playBackgroundMusic() {
            backgroundMusic.src = backgroundMusics[currentMusicIndex].url;
            backgroundMusic.play()
                .then(() => {
                    isMusicPlaying = true;
                    musicControl.textContent = 'â¸';
                    showMusicName(backgroundMusics[currentMusicIndex].name);
                })
                .catch(error => {
                    console.error('éŸ³æ¨‚æ’­æ”¾éŒ¯èª¤:', error);
                    showError('éŸ³æ¨‚æ’­æ”¾å¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡');
                });
        }

        // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        function showError(message) {
            const errorMsg = document.createElement('div');
            errorMsg.style.position = 'fixed';
            errorMsg.style.top = '120px';
            errorMsg.style.right = '20px';
            errorMsg.style.background = 'rgba(255, 99, 99, 0.9)';
            errorMsg.style.padding = '10px';
            errorMsg.style.borderRadius = '10px';
            errorMsg.style.color = 'white';
            errorMsg.style.zIndex = '1000';
            errorMsg.textContent = message;
            document.body.appendChild(errorMsg);
            setTimeout(() => errorMsg.remove(), 3000);
        }

        function showMusicName(name) {
            const musicName = document.createElement('div');
            musicName.style.position = 'fixed';
            musicName.style.top = '80px';
            musicName.style.right = '20px';
            musicName.style.background = 'rgba(255, 255, 255, 0.9)';
            musicName.style.padding = '5px 10px';
            musicName.style.borderRadius = '10px';
            musicName.style.fontSize = '14px';
            musicName.style.color = '#ff6b6b';
            musicName.style.zIndex = '1000';
            musicName.textContent = `æ­£åœ¨æ’­æ”¾: ${name}`;
            
            document.body.appendChild(musicName);
            setTimeout(() => musicName.remove(), 2000);
        }

        // éŸ³é‡èª¿æ•´åŠŸèƒ½
        document.addEventListener('keydown', (event) => {
            if (isControlLocked) return;  // å¦‚æœæ§åˆ¶è¢«é–å®šï¼Œä¸åŸ·è¡Œä»»ä½•æ“ä½œ

            // å¦‚æœéŸ³æ¨‚é‚„æ²’é–‹å§‹æ’­æ”¾ï¼Œé–‹å§‹æ’­æ”¾
            if (!isMusicPlaying) {
                playBackgroundMusic();
            }

            // éŸ³é‡æ§åˆ¶
            if (event.key === '+' || event.key === '=') {
                backgroundMusic.volume = Math.min(1, backgroundMusic.volume + 0.1);
                showVolumeIndicator(backgroundMusic.volume);
            }
            if (event.key === '-') {
                backgroundMusic.volume = Math.max(0, backgroundMusic.volume - 0.1);
                showVolumeIndicator(backgroundMusic.volume);
            }

            // å‰µå»ºæ•ˆæœå’Œåˆ‡æ›åœ–ç‰‡
            for (let i = 0; i < 5; i++) {
                setTimeout(() => createEffect(), i * 50);
            }
            playSound();
            changeImage();
            updateCounter();
        });

        document.addEventListener('keyup', (event) => {
        });

        // ä¿®æ”¹é»æ“Šäº‹ä»¶
        mainImage.addEventListener('click', () => {
            if (isControlLocked) return;  // å¦‚æœæ§åˆ¶è¢«é–å®šï¼Œä¸åŸ·è¡Œä»»ä½•æ“ä½œ

            // å¦‚æœéŸ³æ¨‚é‚„æ²’é–‹å§‹æ’­æ”¾ï¼Œé–‹å§‹æ’­æ”¾
            if (!isMusicPlaying) {
                playBackgroundMusic();
            }

            // å‰µå»ºæ•ˆæœå’Œåˆ‡æ›åœ–ç‰‡
            for (let i = 0; i < 5; i++) {
                setTimeout(() => createEffect(), i * 50);
            }
            playSound();
            changeImage();
            updateCounter();
        });

        function showVolumeIndicator(volume) {
            const volumeIndicator = document.createElement('div');
            volumeIndicator.style.position = 'fixed';
            volumeIndicator.style.top = '80px';
            volumeIndicator.style.right = '20px';
            volumeIndicator.style.background = 'rgba(255, 255, 255, 0.9)';
            volumeIndicator.style.padding = '5px 10px';
            volumeIndicator.style.borderRadius = '10px';
            volumeIndicator.style.fontSize = '14px';
            volumeIndicator.style.color = '#ff6b6b';
            volumeIndicator.style.zIndex = '1000';
            volumeIndicator.textContent = `éŸ³é‡: ${Math.round(volume * 100)}%`;
            
            document.body.appendChild(volumeIndicator);
            setTimeout(() => volumeIndicator.remove(), 1000);
        }

        function playSound() {
            // åŒæ™‚æ’­æ”¾å…©å€‹éŸ³æ•ˆ
            const audio1 = new Audio(sounds[currentSoundIndex]);
            const audio2 = new Audio(sounds[(currentSoundIndex + 1) % sounds.length]);
            
            audio1.volume = 0.4;  // é™ä½éŸ³æ•ˆéŸ³é‡åˆ° 40%
            audio2.volume = 0.4;  // é™ä½éŸ³æ•ˆéŸ³é‡åˆ° 40%
            
            // ç¨å¾®å»¶é²ç¬¬äºŒå€‹éŸ³æ•ˆ
            audio1.play().catch(error => {
                console.log('ç„¡æ³•æ’­æ”¾éŸ³æ•ˆï¼Œè«‹ç¢ºèªéŸ³æ•ˆæª”æ¡ˆè·¯å¾‘æ˜¯å¦æ­£ç¢º');
            });
            
            setTimeout(() => {
                audio2.play().catch(error => {
                    console.log('ç„¡æ³•æ’­æ”¾éŸ³æ•ˆï¼Œè«‹ç¢ºèªéŸ³æ•ˆæª”æ¡ˆè·¯å¾‘æ˜¯å¦æ­£ç¢º');
                });
            }, 50);

            currentSoundIndex = (currentSoundIndex + 1) % sounds.length;
        }

        function createEffect() {
            const effect = document.createElement('div');
            effect.className = 'effect';
            effect.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            
            // éš¨æ©Ÿä½ç½®ï¼ˆæ•´å€‹è¦–çª—ç¯„åœï¼‰
            const startX = Math.random() * window.innerWidth;
            const startY = Math.random() * window.innerHeight;
            
            // éš¨æ©Ÿç§»å‹•æ–¹å‘å’Œè·é›¢
            const moveX = (Math.random() - 0.5) * 300; // -150px åˆ° 150px
            const moveY = (Math.random() - 0.5) * 300; // -150px åˆ° 150px
            const rotation = (Math.random() - 0.5) * 360; // -180åº¦ åˆ° 180åº¦
            
            effect.style.left = startX + 'px';
            effect.style.top = startY + 'px';
            effect.style.setProperty('--moveX', moveX + 'px');
            effect.style.setProperty('--moveY', moveY + 'px');
            effect.style.setProperty('--rotation', rotation + 'deg');
            
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 2000);
        }

        function createClouds() {
            const cloud = document.createElement('div');
            cloud.className = 'cloud';
            cloud.style.top = Math.random() * 50 + '%';
            cloud.style.width = Math.random() * 100 + 50 + 'px';
            cloud.style.height = Math.random() * 30 + 20 + 'px';
            cloud.style.animationDuration = Math.random() * 20 + 10 + 's';
            document.getElementById('background-scene').appendChild(cloud);
            setTimeout(() => cloud.remove(), 30000);
        }

        function createBackgroundElements() {
            const scene = document.getElementById('background-scene');
            
            // å‰µå»ºå½©è™¹
            const rainbow = document.createElement('div');
            rainbow.className = 'rainbow';
            scene.appendChild(rainbow);

            // å‰µå»ºæ˜Ÿæ˜Ÿ
            for (let i = 0; i < 15; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.textContent = 'â­';
                star.style.left = Math.random() * 100 + 'vw';
                star.style.top = Math.random() * 50 + 'vh';
                star.style.animationDelay = Math.random() * 2 + 's';
                scene.appendChild(star);
            }

            // å‰µå»ºè´è¶
            const butterfly = document.createElement('div');
            butterfly.className = 'butterfly';
            butterfly.textContent = 'ğŸ¦‹';
            scene.appendChild(butterfly);

            // å‰µå»ºèŠ±æœµ
            for (let i = 0; i < 8; i++) {
                const flower = document.createElement('div');
                flower.className = 'flower';
                flower.textContent = ['ğŸŒ¸', 'ğŸŒº', 'ğŸŒ¼', 'ğŸŒ»', 'ğŸŒ¹', 'ğŸŒ·', 'ğŸŒ±', 'ğŸŒ¿'][i];
                flower.style.left = (i * 15 + 5) + 'vw';
                flower.style.animationDelay = i * 0.2 + 's';
                scene.appendChild(flower);
            }

            // å‰µå»ºæ°£æ³¡
            for (let i = 0; i < 10; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.style.left = Math.random() * 100 + 'vw';
                bubble.style.width = Math.random() * 30 + 10 + 'px';
                bubble.style.height = bubble.style.width;
                bubble.style.animationDelay = Math.random() * 5 + 's';
                scene.appendChild(bubble);
            }

            // å®šæœŸæ›´æ–°èƒŒæ™¯å…ƒç´ 
            setInterval(() => {
                // ç§»é™¤èˆŠçš„æ°£æ³¡
                const oldBubbles = scene.querySelectorAll('.bubble');
                oldBubbles.forEach(bubble => bubble.remove());

                // å‰µå»ºæ–°çš„æ°£æ³¡
                for (let i = 0; i < 10; i++) {
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    bubble.style.left = Math.random() * 100 + 'vw';
                    bubble.style.width = Math.random() * 30 + 10 + 'px';
                    bubble.style.height = bubble.style.width;
                    bubble.style.animationDelay = Math.random() * 5 + 's';
                    scene.appendChild(bubble);
                }
            }, 8000); // æ¯8ç§’æ›´æ–°ä¸€æ¬¡
        }

        function updateBackground(imageSrc) {
            const scene = document.getElementById('background-scene');
            scene.innerHTML = ''; // æ¸…é™¤ä¹‹å‰çš„èƒŒæ™¯å…ƒç´ 
            let sceneType = 'farm'; // é»˜èªå ´æ™¯

            // æ ¹æ“šåœ–ç‰‡URLåˆ¤æ–·å‹•ç‰©é¡å‹
            Object.entries(backgroundTypes).forEach(([animal, type]) => {
                if (imageSrc.toLowerCase().includes(animal.toLowerCase())) {
                    sceneType = type;
                }
            });

            // æ›´æ–°å ´æ™¯
            scene.className = `scene-${sceneType}`;
            
            // æ·»åŠ èƒŒæ™¯å…ƒç´ 
            createBackgroundElements();
            
            // å¦‚æœä¸æ˜¯æµ·æ´‹å ´æ™¯ï¼Œæ·»åŠ é›²æœµ
            if (sceneType !== 'ocean') {
                createClouds();
            }
        }

        function addRandomAccessory() {
            const container = document.querySelector('.image-container');
            container.querySelectorAll('.accessory').forEach(acc => acc.remove());

            // éš¨æ©Ÿé¸æ“‡é…ä»¶
            if (Math.random() > 0.5) {
                const accessoryTypes = Object.keys(accessories);
                const type = accessoryTypes[Math.floor(Math.random() * accessoryTypes.length)];
                const accessory = accessories[type][Math.floor(Math.random() * accessories[type].length)];

                const accessoryDiv = document.createElement('div');
                accessoryDiv.className = `accessory ${type}`;
                accessoryDiv.textContent = accessory;
                container.appendChild(accessoryDiv);
            }
        }

        function changeImage() {
            currentImageIndex = (currentImageIndex + 1) % images.length;
            mainImage.src = images[currentImageIndex];
            
            updateAnimalName(currentImageIndex);
            
            // éš¨æ©Ÿè·³å‹•æ•ˆæœ
            const randomScale = 1 + Math.random() * 0.3; // 1.0 åˆ° 1.3 ä¹‹é–“çš„éš¨æ©Ÿå€¼
            const randomRotate = (Math.random() - 0.5) * 20; // -10 åˆ° 10 åº¦ä¹‹é–“çš„éš¨æ©Ÿå€¼
            mainImage.style.transform = `scale(${randomScale}) rotate(${randomRotate}deg)`;
            setTimeout(() => {
                mainImage.style.transform = 'scale(1) rotate(0deg)';
            }, 300);

            addRandomAccessory();
            startVoiceTimer();
        }

        function createFirework(x, y) {
            for (let i = 0; i < 36; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = x + 'px';
                firework.style.top = y + 'px';
                firework.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                
                const angle = (i * 10) * Math.PI / 180;
                const distance = 100 + Math.random() * 50;
                const moveX = Math.cos(angle) * distance;
                const moveY = Math.sin(angle) * distance;
                
                firework.style.setProperty('--x', moveX + 'px');
                firework.style.setProperty('--y', moveY + 'px');
                
                document.body.appendChild(firework);
                setTimeout(() => firework.remove(), 1000);
            }
        }

        function speakNumber(number) {
            if (isControlLocked) return;
            
            // å–æ¶ˆä¹‹å‰çš„èªéŸ³
            if (speechUtterance) {
                synth.cancel();
            }

            speechUtterance = new SpeechSynthesisUtterance(`æ•¸å­—${number}`);
            
            // è¨­ç½®èªéŸ³åƒæ•¸
            speechUtterance.lang = 'zh-TW';
            speechUtterance.rate = 0.9;
            speechUtterance.pitch = 1.2;
            speechUtterance.volume = 7.0;  // å¢åŠ éŸ³é‡åˆ° 7.0
            
            // å°‹æ‰¾æ›´é©åˆçš„èªéŸ³
            let voices = synth.getVoices();
            let childVoice = voices.find(voice => 
                voice.lang.includes('zh') && 
                (voice.name.includes('Child') || voice.name.includes('Kid')));
            
            if (!childVoice) {
                childVoice = voices.find(voice => 
                    voice.lang.includes('zh') && 
                    (voice.name.includes('Female') || voice.name.includes('Girl')));
            }
            
            if (!childVoice) {
                childVoice = voices.find(voice => voice.lang.includes('zh'));
            }
            
            if (childVoice) {
                speechUtterance.voice = childVoice;
            }

            synth.speak(speechUtterance);
        }

        let isControlLocked = false;  // æ–°å¢æ§åˆ¶é–å®šç‹€æ…‹
        let lastClickTime = 0;  // æ–°å¢ä¸Šæ¬¡é»æ“Šæ™‚é–“è¨˜éŒ„
        const CLICK_COOLDOWN = 1500;  // é»æ“Šå†·å»æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰

        // ä¿®æ”¹è¨ˆæ•¸å™¨é»æ“Šäº‹ä»¶ï¼Œæ·»åŠ å†·å»æ™‚é–“
        document.getElementById('counter').addEventListener('click', () => {
            if (isControlLocked) return;
            
            const currentTime = Date.now();
            if (currentTime - lastClickTime < CLICK_COOLDOWN) {
                return;  // å¦‚æœåœ¨å†·å»æ™‚é–“å…§ï¼Œä¸åŸ·è¡Œé»æ“Š
            }
            
            lastClickTime = currentTime;  // æ›´æ–°æœ€å¾Œé»æ“Šæ™‚é–“
            speakNumber(counter);
        });

        let currentEggIndex = 0;
        const eggImages = ['è›‹1.png', 'è›‹2.png', 'è›‹3.png', 'è›‹4.png'];
        let eggElement = null;

        function createFlyingEgg() {
            const scene = document.getElementById('background-scene');
            
            // å¦‚æœå·²ç¶“å­˜åœ¨è›‹ï¼Œå…ˆç§»é™¤
            if (eggElement) {
                eggElement.remove();
            }

            // å‰µå»ºæ–°çš„è›‹
            eggElement = document.createElement('img');
            eggElement.className = 'flying-egg';
            eggElement.src = eggImages[currentEggIndex];
            
            // è¨­ç½®åˆå§‹ä½ç½®ï¼ˆå¾ç•«é¢ä¸­é–“é–‹å§‹ï¼‰
            const startX = window.innerWidth / 2;
            const startY = window.innerHeight / 2;
            eggElement.style.left = startX + 'px';
            eggElement.style.top = startY + 'px';
            
            // è¨­ç½®åˆå§‹é€Ÿåº¦å’Œæ–¹å‘
            let x = startX;
            let y = startY;
            let dx = 1 + Math.random() * 1; // é™ä½é€Ÿåº¦åˆ° 1-2
            let dy = 1 + Math.random() * 1; // é™ä½é€Ÿåº¦åˆ° 1-2
            let rotation = 0;
            
            // å‹•ç•«å‡½æ•¸
            function animate() {
                // æ›´æ–°ä½ç½®
                x += dx;
                y += dy;
                rotation += dx * 0.3; // é™ä½æ—‹è½‰é€Ÿåº¦
                
                // æª¢æŸ¥é‚Šç•Œç¢°æ’
                if (x <= 0 || x >= window.innerWidth - 60) {
                    dx = -dx; // æ°´å¹³åå½ˆ
                }
                if (y <= 0 || y >= window.innerHeight - 60) {
                    dy = -dy; // å‚ç›´åå½ˆ
                }
                
                // æ›´æ–°è›‹çš„ä½ç½®å’Œæ—‹è½‰
                eggElement.style.transform = `translate(${x - startX}px, ${y - startY}px) rotate(${rotation}deg)`;
                
                // ç¹¼çºŒå‹•ç•«
                requestAnimationFrame(animate);
            }
            
            // é–‹å§‹å‹•ç•«
            animate();
            scene.appendChild(eggElement);
        }

        function updateEggOnReward() {
            // æ›´æ–°è›‹çš„ç´¢å¼•
            currentEggIndex = (currentEggIndex + 1) % eggImages.length;
            
            // é‡æ–°å‰µå»ºè›‹
            createFlyingEgg();
        }

        function updateCounter() {
            const random = Math.random();
            if (random < 0.7) { // 70% æ©Ÿç‡å¢åŠ 
                counter++;
                if (counter >= 10) {
                    // é–å®šæ§åˆ¶
                    isControlLocked = true;
                    
                    // è§¸ç™¼çå‹µ
                    counter = 0;
                    
                    // æ›´æ–°è›‹çš„å‹•ç•«
                    updateEggOnReward();
                    
                    // éš¨æ©Ÿé¸æ“‡ä¸€å€‹æ–°çš„é¡è‰²ï¼ˆæ’é™¤ç•¶å‰é¡è‰²ï¼‰
                    let newColorIndex;
                    do {
                        newColorIndex = Math.floor(Math.random() * rewardColors.length);
                    } while (newColorIndex === currentColorIndex);
                    currentColorIndex = newColorIndex;
                    
                    // æ›´æ–°èƒŒæ™¯é¡è‰²
                    const newColor = rewardColors[currentColorIndex];
                    const backgroundScene = document.getElementById('background-scene');
                    backgroundScene.style.background = newColor;
                    document.body.style.background = newColor;
                    
                    // ç§»é™¤æ‰€æœ‰å ´æ™¯é¡åˆ¥
                    backgroundScene.classList.remove('scene-ocean', 'scene-savanna', 'scene-farm');
                    
                    // æš«åœèƒŒæ™¯éŸ³æ¨‚
                    backgroundMusic.pause();
                    
                    // æ’­æ”¾å¾—çéŸ³æ•ˆ
                    const rewardSound = new Audio('é ’ç.mp3');
                    rewardSound.volume = 0.8;  // å¢åŠ éŸ³é‡
                    rewardSound.play().catch(error => {
                        console.error('å¾—çéŸ³æ•ˆæ’­æ”¾å¤±æ•—:', error);
                    }).then(() => {
                        // éŸ³æ•ˆæ’­æ”¾å®Œæˆå¾Œæ¢å¾©èƒŒæ™¯éŸ³æ¨‚
                        setTimeout(() => {
                            if (isMusicPlaying) {
                                backgroundMusic.play();
                            }
                        }, 4000);  // æ”¹ç‚º4ç§’å¾Œæ¢å¾©
                    });
                    
                    // å‰µå»ºæ›´å¤šç…™ç«æ•ˆæœ
                    for (let i = 0; i < 15; i++) {
                        setTimeout(() => {
                            createFirework(
                                Math.random() * window.innerWidth,
                                Math.random() * window.innerHeight
                            );
                        }, i * 100);
                    }
                    
                    // å‰µå»ºå½©è‰²æ˜Ÿæ˜Ÿæ•ˆæœ
                    for (let i = 0; i < 30; i++) {
                        setTimeout(() => {
                            const star = document.createElement('div');
                            star.className = 'effect';
                            star.textContent = 'â­';
                            star.style.left = Math.random() * window.innerWidth + 'px';
                            star.style.top = Math.random() * window.innerHeight + 'px';
                            star.style.setProperty('--moveX', (Math.random() - 0.5) * 800 + 'px');
                            star.style.setProperty('--moveY', (Math.random() - 0.5) * 800 + 'px');
                            star.style.setProperty('--rotation', (Math.random() - 0.5) * 720 + 'deg');
                            star.style.fontSize = '40px';
                            document.body.appendChild(star);
                            setTimeout(() => star.remove(), 2000);
                        }, i * 50);
                    }
                    
                    // é¡¯ç¤ºçå‹µè¨Šæ¯
                    const rewardMsg = document.createElement('div');
                    rewardMsg.style.position = 'fixed';
                    rewardMsg.style.top = '50%';
                    rewardMsg.style.left = '50%';
                    rewardMsg.style.transform = 'translate(-50%, -50%)';
                    rewardMsg.style.fontSize = '72px';
                    rewardMsg.style.color = '#FF6B6B';
                    rewardMsg.style.fontWeight = 'bold';
                    rewardMsg.style.textShadow = '6px 6px 12px rgba(0,0,0,0.3)';
                    rewardMsg.style.zIndex = '1000';
                    rewardMsg.style.background = 'rgba(255, 255, 255, 0.95)';
                    rewardMsg.style.padding = '20px 40px';
                    rewardMsg.style.borderRadius = '30px';
                    rewardMsg.style.boxShadow = '0 12px 24px rgba(0,0,0,0.2)';
                    rewardMsg.style.animation = 'bounce 0.5s ease infinite';
                    rewardMsg.style.display = 'inline-block';  // æ”¹ç‚ºè¡Œå…§å¡Šç´šå…ƒç´ 
                    rewardMsg.style.whiteSpace = 'nowrap';  // é˜²æ­¢æ–‡å­—æ›è¡Œ
                    
                    // æ ¹æ“šé¡è‰²é¡¯ç¤ºå°æ‡‰çš„é¡è‰²åç¨±
                    const colorNames = {
                        '#FF69B4': 'ç´…è‰²',
                        '#32CD32': 'ç¶ è‰²',
                        '#0000FF': 'è—è‰²',
                        '#FFD700': 'é‡‘è‰²'
                    };
                    rewardMsg.textContent = `ğŸ‰ å¤ªæ£’äº†ï¼ç²å¾—${colorNames[solidColors[currentColorIndex]]}ï¼ğŸ‰`;
                    document.body.appendChild(rewardMsg);

                    // 2ç§’å¾Œè§£é™¤æ§åˆ¶é–å®š
                    setTimeout(() => {
                        isControlLocked = false;
                        rewardMsg.remove();
                    }, 4000);  // æ”¹ç‚º4ç§’å¾Œç§»é™¤æç¤ºè¨Šæ¯
                }
            } else { // 30% æ©Ÿç‡æ­¸é›¶
                counter = 0;
            }
            document.getElementById('counter').innerHTML = `
                <div>æ•¸åˆ°å</div>
                <div style="font-size: 72px;">${counter}</div>
            `;
        }

        // ç¢ºä¿èªéŸ³å¼•æ“å·²åŠ è¼‰
        speechSynthesis.onvoiceschanged = function() {
            let voices = synth.getVoices();
            console.log('å¯ç”¨çš„èªéŸ³:', voices.map(v => `${v.name} (${v.lang})`).join('\n'));
        };

        // ä¿®æ”¹åˆå§‹åŒ–éƒ¨åˆ†ï¼Œç¢ºä¿è›‹åœ¨é é¢åŠ è¼‰å¾Œç«‹å³å‰µå»º
        window.addEventListener('load', () => {
            // åˆå§‹åŒ–éŸ³æ¨‚æº
            backgroundMusic.src = backgroundMusics[currentMusicIndex].url;
            
            // åˆå§‹åŒ–èƒŒæ™¯å’Œå‹•ç‰©åç¨±
            updateBackground(images[0]);
            updateAnimalName(0);
            startVoiceTimer();
            
            // å‰µå»ºèƒŒæ™¯å…ƒç´ 
            createBackgroundElements();
            
            // å‰µå»ºè›‹ï¼ˆç¢ºä¿åœ¨æœ€å¾ŒåŸ·è¡Œï¼‰
            setTimeout(createFlyingEgg, 100);
        });

        // ä¿®æ”¹å½ˆè·³å‹•ç•«
        const style = document.createElement('style');
        style.textContent = `
            @keyframes bounce {
                0%, 100% { transform: translate(-50%, -50%) scale(1); }
                50% { transform: translate(-50%, -50%) scale(1.1); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html> 